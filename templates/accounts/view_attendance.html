{% extends "base.html" %}

{% block title %}View Attendance{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-calendar3 me-2" viewBox="0 0 16 16">
                    <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857V3.857z"/>
                    <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                </svg>
                Attendance Records
                {% if not is_admin %}<small class="ms-2">(Your Attendance)</small>{% endif %}
            </h4>
        </div>
        <div class="card-body">
            <!-- Filters -->
            <form method="get" class="row g-3 mb-4">
                <div class="col-md-3">
                    <label for="date_from" class="form-label">From Date</label>
                    <input type="date" name="date_from" id="date_from" class="form-control" value="{{ date_from }}">
                </div>
                <div class="col-md-3">
                    <label for="date_to" class="form-label">To Date</label>
                    <input type="date" name="date_to" id="date_to" class="form-control" value="{{ date_to }}">
                </div>
                <div class="col-md-2">
                    <label for="status" class="form-label">Status</label>
                    <select name="status" id="status" class="form-select">
                        <option value="">All</option>
                        <option value="present" {% if status_filter == 'present' %}selected{% endif %}>Present</option>
                        <option value="absent" {% if status_filter == 'absent' %}selected{% endif %}>Absent</option>
                        <option value="leave" {% if status_filter == 'leave' %}selected{% endif %}>Leave</option>
                    </select>
                </div>
                {% if is_admin %}
                <div class="col-md-3">
                    <label for="user" class="form-label">Staff Member</label>
                    <select name="user" id="user" class="form-select">
                        <option value="">All Staff</option>
                        {% for user in all_users %}
                            <option value="{{ user.id }}" {% if user_filter == user.id|stringformat:'s' %}selected{% endif %}>
                                {{ user.get_full_name }} - {{ user.trainerprofile.designation }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}
                <div class="col-md-1 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-funnel" viewBox="0 0 16 16">
                            <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5v-2z"/>
                        </svg>
                    </button>
                </div>
            </form>

            <!-- Attendance Table -->
            {% if attendances %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                {% if is_admin %}<th>Staff Member</th>{% endif %}
                                {% if is_admin %}<th>Designation</th>{% endif %}
                                <th>Date</th>
                                <th>Status</th>
                                <th>Marked By</th>
                                <th>Time</th>
                                <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for attendance in attendances %}
                                <tr>
                                    {% if is_admin %}
                                        <td>{{ attendance.user.get_full_name }}</td>
                                        <td>
                                            <span class="badge bg-info">{{ attendance.user.trainerprofile.designation }}</span>
                                        </td>
                                    {% endif %}
                                    <td>{{ attendance.date|date:'M d, Y' }}</td>
                                    <td>
                                        {% if attendance.status == 'present' %}
                                            <span class="badge bg-success">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-check-circle me-1" viewBox="0 0 16 16">
                                                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                                    <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                                                </svg>
                                                Present
                                            </span>
                                        {% elif attendance.status == 'absent' %}
                                            <span class="badge bg-danger">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-x-circle me-1" viewBox="0 0 16 16">
                                                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                                    <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                                                </svg>
                                                Absent
                                            </span>
                                        {% else %}
                                            <span class="badge bg-warning text-dark">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-dash-circle me-1" viewBox="0 0 16 16">
                                                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                                    <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
                                                </svg>
                                                Leave
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td>{{ attendance.marked_by.get_full_name }}</td>
                                    <td>{{ attendance.marked_at|date:'M d, h:i A' }}</td>
                                    <td>{{ attendance.remarks|default:'-' }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-5">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#ccc" class="bi bi-inbox mb-3" viewBox="0 0 16 16">
                        <path d="M4.98 4a.5.5 0 0 0-.39.188L1.54 8H6a.5.5 0 0 1 .5.5 1.5 1.5 0 1 0 3 0A.5.5 0 0 1 10 8h4.46l-3.05-3.812A.5.5 0 0 0 11.02 4H4.98zm9.954 5H10.45a2.5 2.5 0 0 1-4.9 0H1.066l.32 2.562a.5.5 0 0 0 .497.438h12.234a.5.5 0 0 0 .496-.438L14.933 9zM3.809 3.563A1.5 1.5 0 0 1 4.981 3h6.038a1.5 1.5 0 0 1 1.172.563l3.7 4.625a.5.5 0 0 1 .096.193l.54 4.325a1.5 1.5 0 0 1-1.493 1.69H1.066a1.5 1.5 0 0 1-1.493-1.69l.54-4.325a.5.5 0 0 1 .096-.193l3.7-4.625z"/>
                    </svg>
                    <p class="text-muted">No attendance records found with the selected filters.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
